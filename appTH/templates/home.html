<!DOCTYPE html>
{% load static %}
<html lang="en">
  
<head>
    <meta charset="utf-8">
    {% if run_state == 1 %}
    <meta http-equiv="refresh" content="10;url=">
    {% endif %}
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>우정바이오 온습도계</title>
    <link href="{% static '/css/main.css' %}" rel="stylesheet" type="text/css">
    <script type="text/javascript">
        function csv_name(){
            var userInput = prompt("저장을 원하는 csv파일의 이름을 입력해주세요. (이름은 영어와 숫자로 구성되어야 합니다.)")
            if(userInput == null){
                alert("취소되었습니다.");
            } else{
                alert("다운로드를 시작합니다.");
                location.href="/th_csv/"+userInput;
            }
        }
        function start_check(){
            var result = confirm("정말로 시작하시겠습니까? 시작시 이전의 데이터는 모두 삭제됩니다.");
            if(result){
                var userInput = prompt("현재날짜와 시간을 입력해주세요. 2020-01-01 18:34:56 의 형태로 입력바랍니다.");
                if(userInput == null){
                    alert("취소되었습니다.");
                } else{
                    alert("성공적으로 실행되었습니다.");
                    location.href="/restart/"+userInput;
                    return true;
                    //alert("잘못된 양식입니다. 다시 입력해주세요.");
                }
                
            }
             return false;
        }
    </script>
</head>
<body>
    <a href="{% url 'home' %}"><img class="logo" src="{% static '/images/KS.jpg' %}"></a>
    
    <h1 class="title1">감염관리사업부 온습도계</h1>
    <div class="pi-select">
        <h4>파이 선택</h4>
        <a href="http://192.168.1.13:8000/"><button class="btn-pi-me">13번</button></a>
        <a href="http://192.168.1.13:8000/"><button class="btn-pi">26번</button></a>
        <a href="http://192.168.1.13:8000/"><button class="btn-pi">27번</button></a>
    </div>
    <div class="result">
        <p class="title2">측정 상태 요약</p>
        <div class="pi-state">
        <p>시작시간: {{th_state.start_time|date:"Y년 m월 d일 H시i분s초"}}</p>
        {% if run_state == 2 %}
        <p>종료시간: {{th_state.end_time|date:"Y년 m월 d일 H시i분s초"}}</p>
        {% endif %}
        <p>최대 습도:</p>
        <table class="table-th">
            <tr class="tr-bar">
                <th><font size = 3>no.</font></th>
                <th><font size = 3>경과 시간</font></th>
                <th><font size =3>습도(%)</font></th>
                <th><font size=3>온도(°C)</font></th>
                <th><font size = 3>현재 시간</font></th>
            </tr>
            <tr>
                <th>{{th_state.run_id}}</th>
                <th>{{th_state.run_time_str}}</th>
                <th>{{th_state.max_hum}}</th>
                <th>{{th_state.max_hum_temp}}</th>
                <th>{{th_state.max_hum_time|date:"H:i:s"}}</th>
            </tr>
        </table>
        {% if run_state == 1 %}
        <p>파이 실행 상태: <strong style="color:red">실행중</strong> </p>
        </div>
        <br>
        <a href="{% url 'end' %}"><button class="btn-end">종료하기</button></a>
        {% else %}
        <p>파이 실행 상태: <strong style="color:blue">대기중</strong> </p>
        </div>
        <br>
        <button class="btn-start" onclick="start_check();">시작하기</button>
        <button class="btn-csv" onclick="csv_name();">csv파일로 저장하기</button>
        {% endif %}
        <br>
        </div>
    </div>
    <div class="result">
        <a href="{% url 'graph' %}"><img class="graph-img" src="{% static '/images/graph.JPG' %}"></a>
        <p class="title2">측정 결과 그래프</p>
    </div>
    <div class="result">
        <a href="{% url 'home' %}"><button class="btn-re">새로고침</button></a>
        <p class="title2">측정 결과 확인</p>
    </div>
    <div class="table-div">
        <table class="table-th2">
            <tr class="tr-bar">
                <th><font size = 3>no.</font></th>
                <th><font size = 3>경과 시간</font></th>
                <th><font size =3>습도(%)</font></th>
                <th><font size=3>온도(°C)</font></th>
                <th><font size = 3>현재 시간</font></th>
            </tr>
        {% for th in th_list %}
            <tr>
                <th><font size = 3>{{th.run_id}}</font></th>
                <th><font size = 3>{{th.run_time_str}}</font></th>
                <th><font size = 3>{{th.humidity}}</font></th>
                <th><font size=3>{{th.temperature}}</font></th>
                <th><font size = 3>{{th.run_time_date|date:"H:i:s"}}</font></th>
            </tr>
        {% endfor %}
        </table>
    </div>
</body>
