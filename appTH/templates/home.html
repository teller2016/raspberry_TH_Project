<!DOCTYPE html>
{% load static %}
<html lang="en">
  
<head>
    <meta charset="utf-8">
    
    <!--    브라우저 너비를 장치 너비에 맞추어 표시함-->
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>우정바이오 온습도계</title>
    <link href="{% static '/css/web.css' %}" media="(min-width:600px)" rel="stylesheet" type="text/css">
    <link href="{% static '/css/mobile.css' %}" media="(max-width:600px)" rel="stylesheet" type="text/css">
    
    <link media="all" href="{% static 'js/nv.d3.css' %}" type="text/css" rel="stylesheet" />
    <script type="text/javascript" src="{% static 'js/d3.min.js' %}"></script>
    <script type="text/javascript" src="{% static 'js/nv.d3.min.js' %}"></script>
    <script src="{% static 'js/stream_layers.js' %}"></script>

    <link rel="stylesheet" type="text/css" href="{% static 'datetimepicker/jquery.datetimepicker.css' %}" />
    <script src="{% static 'datetimepicker/jquery.js' %}"></script>
    <script src="{% static 'datetimepicker/build/jquery.datetimepicker.full.min.js' %}"></script>
    
    <link rel="stylesheet" href="{% static 'wickedpicker/stylesheets/wickedpicker.css' %}">
    <script src="{% static 'wickedpicker/src/wickedpicker.js' %}"></script>
    
    <!-- javascript on static file -->
    <script src="{% static 'js/functions.js' %}"></script>
    <!-- home.html ajax functions -->
    <script src="{% static 'js/home_ajax.js' %}"></script>
    
    <script type="text/javascript">
    
    
        String.prototype.replaceAll = function(org, dest) {
            return this.split(org).join(dest);
        }

    </script>
    
    <style>
        text {
            font: 12px sans-serif;
        }
        svg {
            display: block;
        }
        #chart, svg {
            margin: 0 auto;
            padding: 0px;
            height: 300px;
            max-width: 700px;
            width: 100%;
        }
    </style>
</head>
<body>
	
		{% include 'header.html' %}
	
	<div class="content-container">
		<div class="pi-select">
        <p class="home-title">온습도계 선택</p>
        <a href="http://192.168.243.1:8000/summary"><button>전체 확인</button></a>
		<a href="http://192.168.243.1:8000/"><button class="btn-me">1번</button></a>
		<a href="http://192.168.243.2:8000/"><button>2번</button></a>
		<a href="http://192.168.243.3:8000/"><button>3번</button></a>
		</div>
        <br>
        <div class="content-summary">
        <a href="{% url 'result' %}"><button class="button2">현재 데이터 조회</button></a>
        <a href="{% url 'beforeResult' %}"><button class="button2">과거 데이터 조회</button></a>
		<p class="home-title bt1">측정 상태 요약</p>
        <p class="time-title">시작시간: {{th_state.start_time|date:"Y/m/d H:i:s"}}</p>
        
        {% if run_state == 2 %}
        <!--    측정이 종료되었을 시 종료시간 표시-->
        <p class="time-title">종료시간: {{th_state.end_time|date:"Y/m/d H:i:s"}}</p>
        {% endif %}

        
        
        <table class="table-th">
            <tr class="tr-bar">
                <th class="ver-line"><font>NO.</font></th>
                <th class="ver-line"><font>경과 시간</font></th>
                <th class="ver-line"><font>최대 습도(%)</font></th>
                <th class="ver-line"><font>온도(°C)</font></th>
                <th class="ver-line"><font>측정 시간</font></th>
            </tr>
            <tr id="cur_state">
                
            </tr>
        </table>
        
        
        
        
        <br>
        {% if run_state == 2 %}
        <p class="home-title">마지막 수치</p>
        {% else %}
        <p class="home-title">실시간 수치</p>
        {% endif %}
        
        
        <table class="table-th">
            <tr class="tr-bar">
                <th class="ver-line"><font>NO.</font></th>
                <th class="ver-line"><font>경과 시간</font></th>
                <th class="ver-line"><font>습도(%)</font></th>
                <th class="ver-line"><font>온도(°C)</font></th>
                <th class="ver-line"><font>측정 시간</font></th>
            </tr>
            <tr id="cur_value">
                
            </tr>
        </table>
        
        <br>
        </div>
        <br>
        
		<div class="pi-state">
		
		
        {% if run_state == 1 %}
        <p>온습도계 실행 상태: <strong style="color:#FF4765">실행중</strong> </p>
        </div>
        
        <br>
        <hr class="hr-div">
        <br>
        
        <table class="table-start">
           <tr>
              <td>날짜</td>
              <td>
                <span id="cur_date" style="color:gray;">date</span>
              </td>
              <td rowspan="3"><button class="btn-end" onclick="end_check();">개별 종료</button></td>
              <td rowspan="3"><button class="btn-endAll" onclick="end_all();">전체 종료</button></td>
           </tr>
           <tr><td colspan="2"><hr></td></tr>
           <tr>
              <td>시간</td>
              <td>
                <span id="cur_time" style="color:gray; padding:10px;">time</span>
              </td>
           </tr>
        </table>
        
        
        
        {% else %}
        <p>온습도계 실행 상태: <strong style="color:blue">대기중</strong> </p>
        </div>
        <br>
        <hr class="hr-div">
        <br>
        
        
        <table class="table-start">
           <tr>
              <td>날짜</td>
              <td>
                <span id="cur_date" style="color:gray;">date</span>
              </td>
              
              <td>
                  측정 주기
              </td>  
              
              <td rowspan="3"><button class="btn-start" onclick="start_check();">개별 측정<br>시작</button></td>
           </tr>
           
           <tr>
               <td colspan="2"><hr></td>
               <td rowspan="2">
                   
                  <input type="range" id="cycle" name="cycle" value="30" min="5" step="5" max="60"  onInput="setCycle()">
                  <label for="cycle" id="cycleLabel">30초</label>
              
              </td>   
           </tr>
           
           <tr>
              <td>시간</td>
              <td>
                <span id="cur_time" style="color:gray; padding:10px;">time</span>
              </td>
           </tr>
        </table>
        
        
        {% endif %}
        

        <script type="text/javascript">
        let currentDate = document.getElementById("cur_date");
        let currentTime = document.getElementById("cur_time");
        function clock(){
            
           
           currentDate.innerText = getDate();
           currentTime.innerText = getTime();
        }
        clock();
        setInterval(clock,1000);
        
        
            
        </script>
        
        
    <div class="graph-div">
    <br><br>
    <a href="{% url 'graph' %}"><button class="button2">더보기</button></a>
    <p class="home-title bt2">측정 결과 그래프</p>
    
    
    <div id="chart" class='with-3d-shadow with-transitions'>
        <svg></svg>
    </div>

    <script type="text/javascript">
        

        var chart = nv.models.lineChart();
        
        nv.addGraph(function() {
        
	
	var dataList = new Array();
	var dataList2 = new Array();
	
	var th_data = [
	  {
	    "key": "습도(%)",
	    "color": "#00ace6",
	    "values": dataList
	  },
	  {
	    "key": "온도(°C)",
	    "color": "#FF4765",
	    "values": dataList2
	  }
	]
	
	
        chart.xAxis.tickFormat((time)=>xAxisLabel(time)).axisLabel("시간(분, 초)");
        
        chart.yDomain([0,100]);
        chart.yTickFormat(d3.format(',.1f'));

        chart.useInteractiveGuideline(true);
        

        d3.select('#chart svg')
            .datum(th_data)
            .call(chart);

        nv.utils.windowResize(chart.update);

        return chart;
    });   

        
        function refreshData(){
                getThState();
                getThData();
                getAllThData();
                
            }
        
        refreshData();
        if( {{run_state}} == 1)
            setInterval(refreshData, 2000); // refresh every x seconds


    </script>
    <br><br><br><br>
	</div>
    <div class="table-div">
	<button class="button2" onclick="csv_name();">엑셀 파일 저장</button>
    <p class="home-title bt2">측정 결과 미리보기</p>
        <table class="table-result" id="table_data">
            
        
        
        </table>
        <br><br>
    </div>
    <br><br>
</body>
